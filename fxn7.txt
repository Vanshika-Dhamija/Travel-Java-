CREATE OR REPLACE FUNCTION createbooking(checki date, checko date, hotel VARCHAR(200), person int) RETURNS INT AS $$ DECLARE hotelno int; room int; new_bookid int; bookdate date; transcid int; roomsupdate int; 
BEGIN SELECT current_date INTO bookdate; SELECT hotelid INTO hotelno FROM hotel WHERE hotelName = createbooking.hotel; SELECT roomNumber INTO room FROM roomsAvailable WHERE hotelID = hotelno LIMIT 1; IF room IS NOT NULL THEN select roomsleft into roomsupdate from hotel where hotelid=hotelno; update hotel set roomsleft= roomsupdate-1 where hotelid=hotelno; delete from roomsavailable where hotelid=hotelno and roomnumber=room; ELSE SELECT roomNumber INTO room FROM hotelBookingDetails, bookhotel WHERE hotelBookingDetails.bookingNumber = bookhotel.bookingNumber AND bookhotel.hotelid = hotelno AND not((bookhotel.checkIn <=checko and bookhotel.checkout>=checko) OR (bookhotel.checkIn <=checki and bookhotel.checkout>=checki) OR (bookhotel.checkin>=checki and bookhotel.checkout<=checko)) LIMIT 1; END IF; SELECT cast(random() * 100 as int) INTO new_bookid; SELECT cast(random() * 10000 as int) INTO transcid; INSERT INTO bookhotel VALUES (bookdate, new_bookid, checki, checko, hotelno, person, transcid); INSERT INTO hotelbookingdetails VALUES (new_bookid, room); RETURN room; 
END; $$ LANGUAGE plpgsql;
